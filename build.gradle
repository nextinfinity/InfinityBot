plugins {
  id "com.github.johnrengelman.shadow" version "5.0.0"
}

apply plugin: 'java'
apply plugin: 'maven'
version = botVersion

jar {
    manifest {
        attributes 'Main-Class': 'net.theinfinitymc.infinitybot.InfinityBot'
    }
}

repositories {
    jcenter()
    maven { url "https://mvnrepository.com/artifact/com.esotericsoftware.yamlbeans/yamlbeans" }
}

dependencies {
    compile group: 'net.dv8tion', name: 'JDA', version: jdaVersion
    compile group: 'com.sedmelluq', name: 'lavaplayer', version: lavaVersion
    compile group: 'com.sedmelluq', name: 'jda-nas', version: nasVersion
    compile group: 'com.google.apis', name: 'google-api-services-youtube', version: 'v3-rev204-1.23.0'
    compile group: 'net.dean.jraw', name: 'JRAW', version: '0.9.0'
    compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.10.0'
    compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.10.0'
    compile group: 'com.esotericsoftware.yamlbeans', name: 'yamlbeans', version: '1.06'
    compile group: 'org.json', name: 'json', version: '20160810'
}


def versionFile = 'src/main/java/net/theinfinitymc/infinitybot/commands/Info.java'
def tempDir = 'build/tmp/sourcesCache'
def versionFileName = 'Info.java'

compileJava.doFirst {
    copy {
        from(versionFile)
        into(tempDir)
    }
    ant.replace(file: versionFile, token: '@botVersion@', value: botVersion)
    ant.replace(file: versionFile, token: '@jdaVersion@', value: jdaVersion)
    ant.replace(file: versionFile, token: '@lavaVersion@', value: lavaVersion)
}

compileJava.doLast {
    copy {
        from(tempDir + '/' + versionFileName)
        into(project.file(versionFile).parent)
    }
}